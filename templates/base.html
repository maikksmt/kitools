{% load i18n static %}<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'de' }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    {# --------- SEO title & description --------- #}
    {% block meta_title %}{% endblock %}
    {% block meta_description %}{% endblock %}

    {# Fallbacks, falls die Blocks nicht belegt sind #}
    {% if block.super %}
    {% endif %}
    {% if not block.meta_title %}
        {% with effective_title=title|default:SITE_NAME %}
            <title>{{ effective_title }}{% if effective_title and SITE_NAME and effective_title != SITE_NAME %} –
                {{ SITE_NAME }}{% endif %}</title>
            <meta property="og:title" content="{{ effective_title }}">
            <meta name="twitter:title" content="{{ effective_title }}">
        {% endwith %}
    {% endif %}
    {% if not block.meta_description %}
        {% with default_desc=_("Einsteigerfreundliche KI-Plattform: Tools, Guides, Prompts & Vergleiche.") %}
            <meta name="description" content="{{ default_desc }}">
            <meta property="og:description" content="{{ default_desc }}">
            <meta name="twitter:description" content="{{ default_desc }}">
        {% endwith %}
    {% endif %}

    {# --------- Canonical URL (ohne Query-String) --------- #}
    {% if request %}
        {% with abs=request.build_absolute_uri %}
            {% with request.get_full_path as p %}
                {% if abs %}
                    {% comment %} Canonical ohne Query-Params {% endcomment %}
                    {% with canon=abs|cut:request.META.QUERY_STRING %}
                        <link rel="canonical" href="{{ abs|cut:'?'|cut:request.META.QUERY_STRING }}">
                    {% endwith %}
                {% endif %}
            {% endwith %}
        {% endwith %}
    {% endif %}

    {# --------- Open Graph Defaults --------- #}
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="{{ SITE_NAME }}">
    {% if request %}
        <meta property="og:url" content="{{ request.build_absolute_uri|default:SITE_URL }}">{% endif %}

    {# --------- Social Image (Override per Block) --------- #}
    {% block meta_image %}{% endblock %}
    {% if not block.meta_image %}
        <meta property="og:image" content="{{ SITE_URL }}/static/og-default.png">
        <meta name="twitter:image" content="{{ SITE_URL }}/static/og-default.png">
    {% endif %}

    {# --------- Twitter Cards --------- #}
    <meta name="twitter:card" content="summary_large_image">

    {# --------- JSON-LD Slot --------- #}
    {% block meta_jsonld %}{% endblock %}

    {# --- Assets: Tailwind/DaisyUI --- #}
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
    {% block head_assets %}{% endblock %}


</head>
<body
        class="flex flex-col min-h-screen justify-between bg-base-100 text-base-content"
>
<!-- Navbar -->
<div class="navbar bg-base-100 shadow-sm">
    <div class="flex-1">
        <a href="/" class="btn btn-ghost text-xl font-bold">KI-Tools</a>
    </div>
    <div class="flex-none">
        <ul class="flex flex-column px-1 space-x-2 items-center">
            <li><a href="/tools/" class="btn btn-ghost">Tools</a></li>
            <li><a href="/guides/" class="btn btn-ghost">{% trans "Guides" %}</a></li>
            <li><a href="/use-cases/" class="btn btn-ghost">{% trans "Anwendungsfälle" %}</a></li>
            <li><a href="/vergleiche/" class="btn btn-ghost">{% trans "Vergleiche" %}</a></li>
            <li><a href="/prompts/" class="btn btn-ghost">{% trans "Prompts" %}</a></li>
            <li class="mx-2"></li>
            <li>
                <!-- Language switch -->
                <form action="{% url 'set_language' %}" method="post" class="inline">
                    {% csrf_token %}
                    <input name="next" type="hidden" value="{{ request.get_full_path }}"/>
                    <select name="language" onchange="this.form.submit()" class="select select-bordered select-sm">
                        {% get_current_language as LANGUAGE_CODE %}
                        <option value="de" {% if LANGUAGE_CODE == 'de' %}selected{% endif %}>DE</option>
                        <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>EN</option>
                    </select>
                </form>
            </li>
            <li>
                <!-- THEME TOGGLE -->
                <div
                        id="theme-toggle"
                        class="relative flex items-center w-28 h-9 rounded-full bg-base-300/90 border border-base-200 shadow-sm"
                >
                    <!-- Moving indicator -->
                    <div
                            id="theme-indicator"
                            class="absolute h-7 w-7 rounded-full shadow-md transition-all duration-300"
                    ></div>

                    <!-- 3 equal buttons -->
                    <button
                            type="button"
                            data-theme-mode="system"
                            class="z-10 grid place-items-center w-1/3 h-full text-base-content/70 hover:text-base-content"
                            title="System"
                    >
                        {% heroicon_solid "computer-desktop" size=18 %}
                    </button>

                    <button
                            type="button"
                            data-theme-mode="light"
                            class="z-10 grid place-items-center w-1/3 h-full text-base-content/70 hover:text-base-content"
                            title="Hell (light)"
                    >
                        {% heroicon_solid "sun" size=18 %}
                    </button>

                    <button
                            type="button"
                            data-theme-mode="dracula"
                            class="z-10 grid place-items-center w-1/3 h-full text-base-content/70 hover:text-base-content"
                            title="Dunkel (dracula)"
                    >
                        {% heroicon_solid "moon" size=18 %}
                    </button>
                </div>
            </li>
        </ul>
    </div>
</div>

<!-- Page container -->
<main class="p-4 lg:py-4 lg:px-6 max-w-8xl mx-auto mb-auto">
    {% block content %}{% endblock %}
</main>

<!-- Footer -->
<footer
        class="footer sm:footer-horizontal footer-center bg-base-300 text-base-content p-4"
>
    <div class="text-sm text-base-content/70">
        <div
                class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"
        >
            <p>© {{ now|default:"2025" }} – KI-Tools & Automatisierung</p>
            <nav class="flex gap-4">
                <a href="/newsletter/" class="link link-hover">{% trans "Newsletter" %}</a>
                <a href="/ueber-uns/" class="link link-hover">{% trans "Über uns" %}</a>
                <a href="/kontakt/" class="link link-hover">{% trans "Kontakt" %}</a>
                <a href="/rechtliches/" class="link link-hover"
                >{% trans "Impressum & Datenschutz" %}</a
                >
            </nav>
        </div>
    </div>
</footer>
<script>
    (() => {
        const KEY = "theme"; // 'system' | 'light' | 'dracula'
        const indicator = document.getElementById("theme-indicator");
        const toggle = document.getElementById("theme-toggle");
        const mq = window.matchMedia("(prefers-color-scheme: dark)");

        function currentThemeForSystem() {
            return mq.matches ? "dracula" : "light";
        }

        function applyTheme(mode) {
            if (mode === "system") {
                localStorage.setItem(KEY, "system");
                document.documentElement.setAttribute(
                    "data-theme",
                    currentThemeForSystem()
                );
            } else {
                localStorage.setItem(KEY, mode);
                document.documentElement.setAttribute("data-theme", mode);
            }
            updateUI(mode);
        }

        function updateUI(mode) {
            // Slider-Position
            const left =
                mode === "system"
                    ? "0.25rem"
                    : mode === "light"
                        ? "calc(33.333% + 0.25rem)"
                        : "calc(66.666% + 0.25rem)";
            indicator.style.left = left;

            // Farbe des Moving-Indicators invertieren:
            const activeTheme =
                document.documentElement.getAttribute("data-theme");
            const isDark = activeTheme === "dracula";
            // hell im Dark-Mode, dunkel im Light-Mode
            indicator.style.backgroundColor = isDark
                ? "rgb(75 85 99)"
                : "rgb(255 255 255)"; // gray-600 / white
            indicator.style.border = isDark
                ? "1px solid rgba(255,255,255,0.08)"
                : "1px solid rgba(0,0,0,0.06)";

            // aktive Button-Farbe (leicht betonen)
            document
                .querySelectorAll("#theme-toggle [data-theme-mode]")
                .forEach((btn) => {
                    const active =
                        btn.dataset.themeMode === mode ||
                        (mode === "system" &&
                            btn.dataset.themeMode === currentThemeForSystem());
                    btn.classList.toggle("text-primary", active);
                    btn.classList.toggle("opacity-90", active);
                });

            // Toggle-Hintergrund leicht anpassen (wirkt in beiden Themes harmonisch)
            toggle.classList.toggle("bg-base-300/90", true);
        }

        // Klick-Handler
        document
            .querySelectorAll("#theme-toggle [data-theme-mode]")
            .forEach((btn) => {
                btn.addEventListener("click", (e) =>
                    applyTheme(e.currentTarget.dataset.themeMode)
                );
            });

        // Initial: System als Default (sonst dark, wie gewünscht)
        const saved = localStorage.getItem(KEY) || "system";
        applyTheme(saved);

        // Reagieren auf OS-Wechsel, wenn System aktiv
        mq.addEventListener?.("change", () => {
            if ((localStorage.getItem(KEY) || "system") === "system")
                applyTheme("system");
        });
    })();
</script>
</body>
</html>
